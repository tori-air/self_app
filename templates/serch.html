<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>folium map</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        #search-box {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<div style="height:1000px; width:1800px;">
    <!-- initmap.htmlの表示 -->
    {% include "initmap.html" %}
</div>

<div id="search-box">
    <form id="route-form" method="POST" action="/foliummap">
        <label>出発地 (Start) :</label><br>
        <input type="text" id="departure" name="departure" placeholder="出発地を入力"><br>
        <label>目的地 (Goal) :</label><br>
        <input type="text" id="destination" name="destination" placeholder="目的地を入力"><br><br>
        <button type="submit">検索</button><br><br>
    </form>
    
    <!-- 現在地取得ボタン -->
    <button id="getLocationButton">現在地を取得</button>
</div>

<script>
    // 現在地を取得してFlaskサーバーにPOSTする
    $(document).ready(function() {
        $('#getLocationButton').on('click', function(e) {
            e.preventDefault();  // デフォルト動作を停止
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var lat = position.coords.latitude;
                    var lon = position.coords.longitude;

                    // FlaskサーバーにPOSTリクエストでデータを送信
                    $.ajax({
                        url: '/',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({ "latitude": lat, "longitude": lon }),
                        success: function(response) {
                            // 地図を再読み込み
                            window.location.reload();
                        },
                        error: function(error) {
                            console.log("Error:", error);
                        }
                    });
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        });
    });
</script>

</body>
</html>
